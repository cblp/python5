#!/bin/bash
set -eu
set -o pipefail

if [[ ! -z "${PYTHON5_LOCALTEST:-}" ]]; then
    if [[ -e dist/package.conf.inplace ]]; then
        package_db_opt="${package_db_opt:-} -package-db=dist/package.conf.inplace"
    fi
    if [[ -d .cabal-sandbox ]]; then
        packages_conf_d="$(echo .cabal-sandbox/*-ghc-*-packages.conf.d)"
        package_db_opt="${package_db_opt:-} -package-db=$packages_conf_d"
    fi
fi

exts=(
    -XExtendedDefaultRules
    -XFlexibleContexts
    -XScopedTypeVariables
)

opts="${exts[@]} ${package_db_opt:-} -hide-package=base -package=python5-prelude"

runhaskell $opts "$@"
